$(function(){
  var test_screen = $('#test_screen');
  var player = null;
  test_screen.html("<%= escape_javascript(render 'new') %>").modal({
    autofocus: false,
    keyboardShortcuts: false,
    transition: 'fade',
    onVisible: function(){
      keyboardJS.setContext('test_screen');
      player = audioInit();
      answerSegInit();
      testFormInit();
      $(window).off('resize', testFormInit).on('resize', testFormInit);
    },
    onHidden: function(){
      $(this).empty();
      keyboardJS.setContext('global');
      if (player) player.destroy();
      $(window).off('resize', testFormInit);
    }
  }).modal('show');
});
