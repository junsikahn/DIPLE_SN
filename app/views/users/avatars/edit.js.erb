$(function() {
  $('#user_form').html("<%= escape_javascript(render 'form') %>").modal('show');

  $('#user_form .file-upload.button').on('click', function() {
    var field = $(this).parentsUntil('.field.file', this);
    var file_input = field.find('input[type="file"]');
    var img = field.find('img');
    file_input.click().off('change').on('change', function() {
      var reader = new FileReader();
      reader.onload = function(e) {
        img[0].src = e.target.result;
      };
      reader.readAsDataURL(file_input[0].files[0]);
    });
  });
});
